<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Flappy Bird Canvas</title>

<style>
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;

  /* ðŸŒˆ Background luar game */
  background: linear-gradient(180deg, #5fd3ff, #cbefff);
  font-family: Arial, sans-serif;
}

canvas {
  background: #87ceeb;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}
</style>
</head>
<body>

<canvas id="game" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = 800;
const HEIGHT = 600;

let gameState = "menu"; // menu | play | over

const images = {};
function loadImg(name, src) {
  const img = new Image();
  img.src = src;
  images[name] = img;
}

loadImg("sky", "assets/Sky bg.png");
loadImg("bg", "assets/bg.png");
loadImg("pipe", "assets/pipe_2.png");
loadImg("title", "assets/title.png");
loadImg("play", "assets/play btn.png");
loadImg("counter", "assets/counter.png");
loadImg("bird1", "assets/fly/frame-1.png");
loadImg("bird2", "assets/fly/frame-2.png");

const sounds = {
  menu: new Audio("assets/main.mp3"),
  game: new Audio("assets/menu.mp3"),
  over: new Audio("assets/over.mp3"),
  flap: new Audio("assets/ter.mp3"),
  point: new Audio("assets/point.mp3"),
};
sounds.menu.loop = true;
sounds.game.loop = true;

// ================= CLASSES =================
class Background {
  constructor(x) {
    this.x = x;
    this.speed = 2;
  }
  update() {
    this.x -= this.speed;
    if (this.x <= -WIDTH) this.x += WIDTH * 2;
  }
  draw() {
    ctx.drawImage(images.bg, this.x, 0, WIDTH, HEIGHT);
  }
}

class Bird {
  constructor() {
    this.x = 150;
    this.y = 200;
    this.vy = 0;
    this.gravity = 0.25;
    this.jump = -4.5;
    this.dead = false;

    this.frame = 0;
    this.animTimer = 0;
    this.animDelay = 8;
    this.rotation = 0;
  }

  update() {
    if (this.dead) return;

    this.vy += this.gravity;
    this.y += this.vy;

    this.rotation = Math.min(Math.max(this.vy * 0.05, -0.4), 0.6);

    this.animTimer++;
    if (this.animTimer >= this.animDelay) {
      this.frame = (this.frame + 1) % 2;
      this.animTimer = 0;
    }

    if (this.y < 20 || this.y > HEIGHT - 20) {
      this.gameOver();
    }
  }

  flap() {
    if (!this.dead) {
      this.vy = this.jump;
      sounds.flap.currentTime = 0;
      sounds.flap.play();
    }
  }

  draw() {
    const img = this.frame === 0 ? images.bird1 : images.bird2;

    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.drawImage(img, -25, -25, 50, 50);
    ctx.restore();
  }

  gameOver() {
    if (this.dead) return;
    this.dead = true;
    gameState = "over";
    sounds.game.pause();
    sounds.over.play();
  }
}

class Pipe {
  constructor(x, y, flip = false) {
    this.x = x;
    this.y = y;
    this.w = 100;
    this.h = 250;
    this.speed = 3;
    this.flip = flip;
    this.scored = false;
  }

  update() {
    this.x -= this.speed;
  }

  draw() {
    ctx.save();
    if (this.flip) {
      ctx.scale(1, -1);
      ctx.drawImage(images.pipe, this.x, -this.y - this.h, this.w, this.h);
    } else {
      ctx.drawImage(images.pipe, this.x, this.y, this.w, this.h);
    }
    ctx.restore();
  }

  collide(b) {
    return (
      b.x + 20 > this.x &&
      b.x - 20 < this.x + this.w &&
      b.y + 20 > this.y &&
      b.y - 20 < this.y + this.h
    );
  }
}

class Counter {
  constructor() {
    this.value = 0;
    this.highScore = parseInt(localStorage.getItem("highScore")) || 0;
  }

  add(v) {
    this.value += v;
    if (this.value > this.highScore) {
      this.highScore = this.value;
      localStorage.setItem("highScore", this.highScore);
    }
  }

  reset() {
    this.value = 0;
  }

  draw() {
    // ðŸ”¹ gambar panel counter
    ctx.drawImage(
      images.counter,
      WIDTH / 2 - 100, // posisi X (tengah)
      10,              // posisi Y
      200,             // lebar
      70               // tinggi
    );

    // ðŸ”¹ teks score
    ctx.fillStyle = "#000";
    ctx.textAlign = "center";

    ctx.font = "26px Arial";
    ctx.fillText(this.value, WIDTH / 2, 45);

    ctx.font = "14px Arial";
    ctx.fillText("High Score: " + this.highScore, WIDTH / 2, 65);

    ctx.textAlign = "left";
  }
}

let bird = new Bird();
let pipes = [];
let bg1 = new Background(0);
let bg2 = new Background(WIDTH);
let pipeTimer = 0;
let counter = new Counter();

function spawnPipe() {
  pipeTimer++;
  if (pipeTimer > 150) {

    const gap = 260;
    const minTop = 80;
    const minBottom = 80;

    const maxCenter = HEIGHT - minBottom - gap / 2;
    const minCenter = minTop + gap / 2;

    const center = Math.random() * (maxCenter - minCenter) + minCenter;

    // pipa atas (terbalik)
    pipes.push(new Pipe(
      WIDTH,
      center - gap / 2 - 250,
      true
    ));

    // pipa bawah (normal)
    pipes.push(new Pipe(
      WIDTH,
      center + gap / 2,
      false
    ));

    pipeTimer = 0;
  }
}

function resetGame() {
  bird = new Bird();
  bird.vy = bird.jump;
  pipes = [];
  pipeTimer = 0;
  counter.reset();

  gameState = "play";
  sounds.over.pause();
  sounds.game.currentTime = 0;
  sounds.game.play();
}

function handleInput() {
  if (gameState === "menu") {
    gameState = "play";
    bird.vy = bird.jump;
    sounds.menu.pause();
    sounds.game.play();
  }
  else if (gameState === "play") {
    bird.flap();
  }
  else if (gameState === "over") {
    resetGame();
  }
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") handleInput();
});
canvas.addEventListener("click", handleInput);

function loop() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  if (gameState === "menu") {
  ctx.drawImage(images.sky, 0, 0, WIDTH, HEIGHT);

  const titleW = 220;
  const titleH = 220;
  const playW = 120;
  const playH = 120;

  // posisi tengah
  const centerX = WIDTH / 2;
  const centerY = HEIGHT / 2;

  ctx.drawImage(
    images.title,
    centerX - titleW / 2,
    centerY - titleH - 20,
    titleW,
    titleH
  );

  ctx.drawImage(
    images.play,
    centerX - playW / 2,
    centerY,
    playW,
    playH
  );

  sounds.menu.play();
}


  if (gameState === "play") {
    bg1.update(); bg2.update();
    bg1.draw(); bg2.draw();

    bird.update();
    bird.draw();

    spawnPipe();

    pipes.forEach(p => {
      p.update();
      p.draw();

      if (p.collide(bird)) bird.gameOver();

      if (!p.scored && bird.x > p.x + p.w) {
        p.scored = true;
        counter.add(5);
        sounds.point.currentTime = 0;
        sounds.point.play();
        sounds.point.volume = 0.5;
      }
    });

    counter.draw();
  }

  if (gameState === "over") {
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.font = "36px Arial";
  ctx.fillText("GAME OVER", WIDTH / 2, HEIGHT / 2 - 20);

  ctx.font = "18px Arial";
  ctx.fillText(
    "Tekan SPACE / Klik untuk restart",
    WIDTH / 2,
    HEIGHT / 2 + 20
  );
}

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
